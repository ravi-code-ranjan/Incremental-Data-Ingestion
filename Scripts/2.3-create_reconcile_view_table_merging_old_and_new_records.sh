#!/bin/bash

dt=`date +%F`;

cat > ~/reporting_table.hql <<EOF
DROP TABLE reporting_table;
CREATE TABLE reporting_table AS
SELECT * 
FROM
(
		SELECT c.*
		FROM incremental_table c 
		LEFT OUTER JOIN base_table o 
		ON (c.cms_certification_number_ccn = o.cms_certification_number_ccn)
		WHERE c.state != o.state OR c.provider_name != o.provider_name OR c.address != o.address OR c.city != o.city OR c.zip != o.zip OR c.phone != o.phone OR c.type_of_ownership != o.type_of_ownership OR c.offers_nursing_care_services != o.offers_nursing_care_services OR c.offers_physical_therapy_services != o.offers_physical_therapy_services OR c.offers_occupational_therapy_services != o.offers_occupational_therapy_services OR c.offers_speech_pathology_services != o.offers_speech_pathology_services OR c.offers_medical_social_services != o.offers_medical_social_services OR c.offers_home_health_aide_services != o.offers_home_health_aide_services OR c.date_certified != o.date_certified OR c.quality_of_patient_care_star_rating != o.quality_of_patient_care_star_rating OR c.footnote_quality_of_patient_care_star_rating != o.footnote_quality_of_patient_care_star_rating OR c.how_often_the_home_health_team_began_their_patients_care_in_a_timely_manner != o.how_often_the_home_health_team_began_their_patients_care_in_a_timely_manner OR c.footnote_for_how_often_the_home_health_team_began_their_patients_care_in_a_timely_manner != o.footnote_for_how_often_the_home_health_team_began_their_patients_care_in_a_timely_manner OR c.how_often_the_home_health_team_taught_patients_or_their_family_caregivers_about_their_drugs != o.how_often_the_home_health_team_taught_patients_or_their_family_caregivers_about_their_drugs OR c.footnote_for_how_often_the_home_health_team_taught_patients_or_their_family_caregivers_about_their_drugs != o.footnote_for_how_often_the_home_health_team_taught_patients_or_their_family_caregivers_about_their_drugs OR c.how_often_the_home_health_team_checked_patients_risk_of_falling != o.how_often_the_home_health_team_checked_patients_risk_of_falling OR c.footnote_for_how_often_the_home_health_team_checked_patients_risk_of_falling != o.footnote_for_how_often_the_home_health_team_checked_patients_risk_of_falling OR c.how_often_the_home_health_team_checked_patients_for_depression != o.how_often_the_home_health_team_checked_patients_for_depression OR c.footnote_for_how_often_the_home_health_team_checked_patients_for_depression != o.footnote_for_how_often_the_home_health_team_checked_patients_for_depression OR c.how_often_the_home_health_team_made_sure_that_their_patients_have_received_a_flu_shot_for_the_current_flu_season != o.how_often_the_home_health_team_made_sure_that_their_patients_have_received_a_flu_shot_for_the_current_flu_season OR c.footnote_for_how_often_the_home_health_team_made_sure_that_their_patients_have_received_a_flu_shot_for_the_current_flu_season != o.footnote_for_how_often_the_home_health_team_made_sure_that_their_patients_have_received_a_flu_shot_for_the_current_flu_season OR c.how_often_the_home_health_team_made_sure_that_their_patients_have_received_a_pneumococcal_vaccine_pneumonia_shot != o.how_often_the_home_health_team_made_sure_that_their_patients_have_received_a_pneumococcal_vaccine_pneumonia_shot OR c.footnote_as_how_often_the_home_health_team_made_sure_that_their_patients_have_received_a_pneumococcal_vaccine_pneumonia_shot != o.footnote_as_how_often_the_home_health_team_made_sure_that_their_patients_have_received_a_pneumococcal_vaccine_pneumonia_shot OR c.with_diabetes_how_often_the_home_health_team_got_doctors_orders_gave_foot_care_and_taught_patients_about_foot_care != o.with_diabetes_how_often_the_home_health_team_got_doctors_orders_gave_foot_care_and_taught_patients_about_foot_care OR c.footnote_for_how_often_the_home_health_team_got_doctors_orders_gave_foot_care_and_taught_patients_about_foot_care != o.footnote_for_how_often_the_home_health_team_got_doctors_orders_gave_foot_care_and_taught_patients_about_foot_care OR c.how_often_the_home_health_team_checked_patients_for_pain != o.how_often_the_home_health_team_checked_patients_for_pain OR c.footnote_for_how_often_the_home_health_team_checked_patients_for_pain != o.footnote_for_how_often_the_home_health_team_checked_patients_for_pain OR c.how_often_the_home_health_team_treated_their_patients_pain != o.how_often_the_home_health_team_treated_their_patients_pain OR c.footnote_for_often_the_home_health_team_treated_their_patients_pain != o.footnote_for_often_the_home_health_team_treated_their_patients_pain OR c.how_often_the_home_health_team_treated_heart_failure_weakening_of_the_heart_patients_symptoms != o.how_often_the_home_health_team_treated_heart_failure_weakening_of_the_heart_patients_symptoms OR c.footnote_for_how_often_the_home_health_team_treated_heart_failure_weakening_of_the_heart_patients_symptoms != o.footnote_for_how_often_the_home_health_team_treated_heart_failure_weakening_of_the_heart_patients_symptoms OR c.how_often_the_home_health_team_took_doctorordered_action_to_prevent_pressure_sores_bed_sores != o.how_often_the_home_health_team_took_doctorordered_action_to_prevent_pressure_sores_bed_sores OR c.footnote_for_how_often_the_home_health_team_took_doctorordered_action_to_prevent_pressure_sores_bed_sores != o.footnote_for_how_often_the_home_health_team_took_doctorordered_action_to_prevent_pressure_sores_bed_sores OR c.how_often_the_home_health_team_included_treatments_to_prevent_pressure_sores_bed_sores_in_the_plan_of_care != o.how_often_the_home_health_team_included_treatments_to_prevent_pressure_sores_bed_sores_in_the_plan_of_care OR c.footnote_for_how_often_the_home_health_team_included_treatments_to_prevent_pressure_sores_bed_sores_in_the_plan_of_care != o.footnote_for_how_often_the_home_health_team_included_treatments_to_prevent_pressure_sores_bed_sores_in_the_plan_of_care OR c.how_often_the_home_health_team_checked_patients_for_the_risk_of_developing_pressure_sores_bed_sores != o.how_often_the_home_health_team_checked_patients_for_the_risk_of_developing_pressure_sores_bed_sores OR c.footnote_for_how_often_the_home_health_team_checked_patients_for_the_risk_of_developing_pressure_sores_bed_sores != o.footnote_for_how_often_the_home_health_team_checked_patients_for_the_risk_of_developing_pressure_sores_bed_sores OR c.how_often_patients_got_better_at_walking_or_moving_around != o.how_often_patients_got_better_at_walking_or_moving_around OR c.footnote_for_how_often_patients_got_better_at_walking_or_moving_around != o.footnote_for_how_often_patients_got_better_at_walking_or_moving_around OR c.how_often_patients_got_better_at_getting_in_and_out_of_bed != o.how_often_patients_got_better_at_getting_in_and_out_of_bed OR c.footnote_for_how_often_patients_got_better_at_getting_in_and_out_of_bed != o.footnote_for_how_often_patients_got_better_at_getting_in_and_out_of_bed OR c.how_often_patients_got_better_at_bathing != o.how_often_patients_got_better_at_bathing OR c.footnote_for_how_often_patients_got_better_at_bathing != o.footnote_for_how_often_patients_got_better_at_bathing OR c.how_often_patients_had_less_pain_when_moving_around != o.how_often_patients_had_less_pain_when_moving_around OR c.footnote_for_how_often_patients_had_less_pain_when_moving_around != o.footnote_for_how_often_patients_had_less_pain_when_moving_around OR c.how_often_patients_breathing_improved != o.how_often_patients_breathing_improved OR c.footnote_for_how_often_patients_breathing_improved != o.footnote_for_how_often_patients_breathing_improved OR c.how_often_patients_wounds_improved_or_healed_after_an_operation != o.how_often_patients_wounds_improved_or_healed_after_an_operation OR c.footnote_for_how_often_patients_wounds_improved_or_healed_after_an_operation != o.footnote_for_how_often_patients_wounds_improved_or_healed_after_an_operation OR c.how_often_patients_got_better_at_taking_their_drugs_correctly_by_mouth != o.how_often_patients_got_better_at_taking_their_drugs_correctly_by_mouth OR c.footnote_for_how_often_patients_got_better_at_taking_their_drugs_correctly_by_mouth != o.footnote_for_how_often_patients_got_better_at_taking_their_drugs_correctly_by_mouth OR c.how_often_home_health_patients_had_to_be_admitted_to_the_hospital != o.how_often_home_health_patients_had_to_be_admitted_to_the_hospital OR c.footnote_for_how_often_home_health_patients_had_to_be_admitted_to_the_hospital != o.footnote_for_how_often_home_health_patients_had_to_be_admitted_to_the_hospital OR c.how_often_patients_receiving_home_health_care_needed_urgent_unplanned_care_in_the_er_without_being_admitted != o.how_often_patients_receiving_home_health_care_needed_urgent_unplanned_care_in_the_er_without_being_admitted OR c.footnote_for_how_often_patients_receiving_home_health_care_needed_urgent_unplanned_care_in_the_er_without_being_admitted != o.footnote_for_how_often_patients_receiving_home_health_care_needed_urgent_unplanned_care_in_the_er_without_being_admitted OR c.how_often_home_health_patients_who_have_had_a_recent_hospital_stay_had_to_be_readmitted_to_the_hospital != o.how_often_home_health_patients_who_have_had_a_recent_hospital_stay_had_to_be_readmitted_to_the_hospital OR c.footnote_for_how_often_home_health_patients_who_have_had_a_recent_hospital_stay_had_to_be_readmitted_to_the_hospital != o.footnote_for_how_often_home_health_patients_who_have_had_a_recent_hospital_stay_had_to_be_readmitted_to_the_hospital OR c.how_often_home_health_patients_who_have_had_a_recent_hospital != o.how_often_home_health_patients_who_have_had_a_recent_hospital OR c.footnote_for_how_often_home_health_patients_who_have_had_a_recent_hospital != o.footnote_for_how_often_home_health_patients_who_have_had_a_recent_hospital OR c.footnote != o.footnote

	UNION ALL

		SELECT c.*
		FROM base_table c 
		LEFT OUTER JOIN incremental_table o 
		ON (c.cms_certification_number_ccn = o.cms_certification_number_ccn)
		WHERE c.state == o.state and c.cms_certification_number_ccn == o.cms_certification_number_ccn and c.provider_name == o.provider_name and c.address == o.address and c.city == o.city and c.zip == o.zip and c.phone == o.phone and c.type_of_ownership == o.type_of_ownership and c.offers_nursing_care_services == o.offers_nursing_care_services and c.offers_physical_therapy_services == o.offers_physical_therapy_services and c.offers_occupational_therapy_services == o.offers_occupational_therapy_services and c.offers_speech_pathology_services == o.offers_speech_pathology_services and c.offers_medical_social_services == o.offers_medical_social_services and c.offers_home_health_aide_services == o.offers_home_health_aide_services and c.date_certified == o.date_certified and c.quality_of_patient_care_star_rating == o.quality_of_patient_care_star_rating and c.footnote_quality_of_patient_care_star_rating == o.footnote_quality_of_patient_care_star_rating and c.how_often_the_home_health_team_began_their_patients_care_in_a_timely_manner == o.how_often_the_home_health_team_began_their_patients_care_in_a_timely_manner and c.footnote_for_how_often_the_home_health_team_began_their_patients_care_in_a_timely_manner == o.footnote_for_how_often_the_home_health_team_began_their_patients_care_in_a_timely_manner and c.how_often_the_home_health_team_taught_patients_or_their_family_caregivers_about_their_drugs == o.how_often_the_home_health_team_taught_patients_or_their_family_caregivers_about_their_drugs and c.footnote_for_how_often_the_home_health_team_taught_patients_or_their_family_caregivers_about_their_drugs == o.footnote_for_how_often_the_home_health_team_taught_patients_or_their_family_caregivers_about_their_drugs and c.how_often_the_home_health_team_checked_patients_risk_of_falling == o.how_often_the_home_health_team_checked_patients_risk_of_falling and c.footnote_for_how_often_the_home_health_team_checked_patients_risk_of_falling == o.footnote_for_how_often_the_home_health_team_checked_patients_risk_of_falling and c.how_often_the_home_health_team_checked_patients_for_depression == o.how_often_the_home_health_team_checked_patients_for_depression and c.footnote_for_how_often_the_home_health_team_checked_patients_for_depression == o.footnote_for_how_often_the_home_health_team_checked_patients_for_depression and c.how_often_the_home_health_team_made_sure_that_their_patients_have_received_a_flu_shot_for_the_current_flu_season == o.how_often_the_home_health_team_made_sure_that_their_patients_have_received_a_flu_shot_for_the_current_flu_season and c.footnote_for_how_often_the_home_health_team_made_sure_that_their_patients_have_received_a_flu_shot_for_the_current_flu_season == o.footnote_for_how_often_the_home_health_team_made_sure_that_their_patients_have_received_a_flu_shot_for_the_current_flu_season and c.how_often_the_home_health_team_made_sure_that_their_patients_have_received_a_pneumococcal_vaccine_pneumonia_shot == o.how_often_the_home_health_team_made_sure_that_their_patients_have_received_a_pneumococcal_vaccine_pneumonia_shot and c.footnote_as_how_often_the_home_health_team_made_sure_that_their_patients_have_received_a_pneumococcal_vaccine_pneumonia_shot == o.footnote_as_how_often_the_home_health_team_made_sure_that_their_patients_have_received_a_pneumococcal_vaccine_pneumonia_shot and c.with_diabetes_how_often_the_home_health_team_got_doctors_orders_gave_foot_care_and_taught_patients_about_foot_care == o.with_diabetes_how_often_the_home_health_team_got_doctors_orders_gave_foot_care_and_taught_patients_about_foot_care and c.footnote_for_how_often_the_home_health_team_got_doctors_orders_gave_foot_care_and_taught_patients_about_foot_care == o.footnote_for_how_often_the_home_health_team_got_doctors_orders_gave_foot_care_and_taught_patients_about_foot_care and c.how_often_the_home_health_team_checked_patients_for_pain == o.how_often_the_home_health_team_checked_patients_for_pain and c.footnote_for_how_often_the_home_health_team_checked_patients_for_pain == o.footnote_for_how_often_the_home_health_team_checked_patients_for_pain and c.how_often_the_home_health_team_treated_their_patients_pain == o.how_often_the_home_health_team_treated_their_patients_pain and c.footnote_for_often_the_home_health_team_treated_their_patients_pain == o.footnote_for_often_the_home_health_team_treated_their_patients_pain and c.how_often_the_home_health_team_treated_heart_failure_weakening_of_the_heart_patients_symptoms == o.how_often_the_home_health_team_treated_heart_failure_weakening_of_the_heart_patients_symptoms and c.footnote_for_how_often_the_home_health_team_treated_heart_failure_weakening_of_the_heart_patients_symptoms == o.footnote_for_how_often_the_home_health_team_treated_heart_failure_weakening_of_the_heart_patients_symptoms and c.how_often_the_home_health_team_took_doctorordered_action_to_prevent_pressure_sores_bed_sores == o.how_often_the_home_health_team_took_doctorordered_action_to_prevent_pressure_sores_bed_sores and c.footnote_for_how_often_the_home_health_team_took_doctorordered_action_to_prevent_pressure_sores_bed_sores == o.footnote_for_how_often_the_home_health_team_took_doctorordered_action_to_prevent_pressure_sores_bed_sores and c.how_often_the_home_health_team_included_treatments_to_prevent_pressure_sores_bed_sores_in_the_plan_of_care == o.how_often_the_home_health_team_included_treatments_to_prevent_pressure_sores_bed_sores_in_the_plan_of_care and c.footnote_for_how_often_the_home_health_team_included_treatments_to_prevent_pressure_sores_bed_sores_in_the_plan_of_care == o.footnote_for_how_often_the_home_health_team_included_treatments_to_prevent_pressure_sores_bed_sores_in_the_plan_of_care and c.how_often_the_home_health_team_checked_patients_for_the_risk_of_developing_pressure_sores_bed_sores == o.how_often_the_home_health_team_checked_patients_for_the_risk_of_developing_pressure_sores_bed_sores and c.footnote_for_how_often_the_home_health_team_checked_patients_for_the_risk_of_developing_pressure_sores_bed_sores == o.footnote_for_how_often_the_home_health_team_checked_patients_for_the_risk_of_developing_pressure_sores_bed_sores and c.how_often_patients_got_better_at_walking_or_moving_around == o.how_often_patients_got_better_at_walking_or_moving_around and c.footnote_for_how_often_patients_got_better_at_walking_or_moving_around == o.footnote_for_how_often_patients_got_better_at_walking_or_moving_around and c.how_often_patients_got_better_at_getting_in_and_out_of_bed == o.how_often_patients_got_better_at_getting_in_and_out_of_bed and c.footnote_for_how_often_patients_got_better_at_getting_in_and_out_of_bed == o.footnote_for_how_often_patients_got_better_at_getting_in_and_out_of_bed and c.how_often_patients_got_better_at_bathing == o.how_often_patients_got_better_at_bathing and c.footnote_for_how_often_patients_got_better_at_bathing == o.footnote_for_how_often_patients_got_better_at_bathing and c.how_often_patients_had_less_pain_when_moving_around == o.how_often_patients_had_less_pain_when_moving_around and c.footnote_for_how_often_patients_had_less_pain_when_moving_around == o.footnote_for_how_often_patients_had_less_pain_when_moving_around and c.how_often_patients_breathing_improved == o.how_often_patients_breathing_improved and c.footnote_for_how_often_patients_breathing_improved == o.footnote_for_how_often_patients_breathing_improved and c.how_often_patients_wounds_improved_or_healed_after_an_operation == o.how_often_patients_wounds_improved_or_healed_after_an_operation and c.footnote_for_how_often_patients_wounds_improved_or_healed_after_an_operation == o.footnote_for_how_often_patients_wounds_improved_or_healed_after_an_operation and c.how_often_patients_got_better_at_taking_their_drugs_correctly_by_mouth == o.how_often_patients_got_better_at_taking_their_drugs_correctly_by_mouth and c.footnote_for_how_often_patients_got_better_at_taking_their_drugs_correctly_by_mouth == o.footnote_for_how_often_patients_got_better_at_taking_their_drugs_correctly_by_mouth and c.how_often_home_health_patients_had_to_be_admitted_to_the_hospital == o.how_often_home_health_patients_had_to_be_admitted_to_the_hospital and c.footnote_for_how_often_home_health_patients_had_to_be_admitted_to_the_hospital == o.footnote_for_how_often_home_health_patients_had_to_be_admitted_to_the_hospital and c.how_often_patients_receiving_home_health_care_needed_urgent_unplanned_care_in_the_er_without_being_admitted == o.how_often_patients_receiving_home_health_care_needed_urgent_unplanned_care_in_the_er_without_being_admitted and c.footnote_for_how_often_patients_receiving_home_health_care_needed_urgent_unplanned_care_in_the_er_without_being_admitted == o.footnote_for_how_often_patients_receiving_home_health_care_needed_urgent_unplanned_care_in_the_er_without_being_admitted and c.how_often_home_health_patients_who_have_had_a_recent_hospital_stay_had_to_be_readmitted_to_the_hospital == o.how_often_home_health_patients_who_have_had_a_recent_hospital_stay_had_to_be_readmitted_to_the_hospital and c.footnote_for_how_often_home_health_patients_who_have_had_a_recent_hospital_stay_had_to_be_readmitted_to_the_hospital == o.footnote_for_how_often_home_health_patients_who_have_had_a_recent_hospital_stay_had_to_be_readmitted_to_the_hospital and c.how_often_home_health_patients_who_have_had_a_recent_hospital == o.how_often_home_health_patients_who_have_had_a_recent_hospital and c.footnote_for_how_often_home_health_patients_who_have_had_a_recent_hospital == o.footnote_for_how_often_home_health_patients_who_have_had_a_recent_hospital and c.footnote == o.footnote

	UNION ALL

		SELECT c.*
		FROM incremental_table c
		LEFT JOIN base_table o 
		ON c.cms_certification_number_ccn = o.cms_certification_number_ccn
		WHERE o.cms_certification_number_ccn is NULL

	UNION ALL

		SELECT c.*
		FROM base_table c
		LEFT JOIN incremental_table o 
		ON c.cms_certification_number_ccn = o.cms_certification_number_ccn
		WHERE o.cms_certification_number_ccn is NULL
) unionResult;
EOF
hive -f ~/reporting_table.hql;


cat > ~/selecttablequery.hql <<EOF
SELECT COUNT(*) 
FROM reporting_table;
EOF

echo "$dt : `hive -f ~/selecttablequery.hql`"  >> /logs/Total_Records.log;

rm -rf ~/selecttablequery.hql;